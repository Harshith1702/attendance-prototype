<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Eclipse Attendance App</title>
<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
<style>
body {font-family: Arial, sans-serif; margin:0; background:#f4f7fc; color:#333; transition: background 0.3s, color 0.3s;}
.dark {background:#1e1e1e; color:#eee;}
header {background:#fff; box-shadow:0 2px 8px rgba(0,0,0,0.1); padding:10px 20px; display:flex; justify-content:space-between; align-items:center; position:sticky; top:0; z-index:100;}
header .logo {font-size:22px; font-weight:700; color:#4e5dff;}
.navbar {display:flex; gap:15px;}
.navbar button {padding:10px 18px; border:none; border-radius:6px; background:#4e5dff; color:white; cursor:pointer; font-weight:600; transition:.3s;}
.navbar button:hover {background:#6e7bff;}
.active-tab {background:#ff6e6e !important;}
.profile {position:relative; cursor:pointer;}
.profile img {width:35px; height:35px; border-radius:50%;}
.dropdown {display:none; position:absolute; right:0; top:45px; background:#fff; box-shadow:0 4px 10px rgba(0,0,0,.1); border-radius:8px; overflow:hidden; min-width:150px;}
.dark .dropdown {background:#2e2e2e;}
.dropdown a {display:block; padding:10px; text-decoration:none; color:inherit;}
.dropdown a:hover {background:#f4f7fc; color:#4e5dff;}
.dark .dropdown a:hover {background:#444;}
main {max-width:1000px; margin:30px auto; padding:20px; background:white; border-radius:10px; box-shadow:0 4px 10px rgba(0,0,0,.1);}
.dark main {background:#2b2b2b;}
.card {background:#fff; border-radius:10px; padding:20px; box-shadow:0 4px 10px rgba(0,0,0,.1); margin-bottom:20px;}
.dark .card {background:#333;}
.qr-container {margin:20px auto; text-align:center;}
table {width:100%; border-collapse:collapse; margin-top:20px;}
th,td {border:1px solid #ddd; padding:10px; text-align:center;}
.dark th, .dark td {border-color:#555;}
th {background:#4e5dff; color:white;}
.badge {padding:5px 10px; border-radius:5px; color:white; font-weight:600;}
.badge-present {background:green;}
.badge-absent {background:red;}
input, select, button {margin:5px 0; padding:8px; font-size:14px;}
button {background:#4e5dff; border:none; color:white; border-radius:6px; cursor:pointer;}
button:hover {background:#6e7bff;}
#qr-modal button {margin-top:10px; padding:8px 12px; border:none; background:#4e5dff; color:white; border-radius:6px; cursor:pointer;}
#qr-modal button:hover {background:#6e7bff;}
#qr-modal {display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); justify-content:center; align-items:center; z-index:200;}
#qr-modal .modal-content {background:white; padding:20px; border-radius:10px; text-align:center; position:relative; width:300px;}
</style>
</head>
<body>

<header>
  <div class="logo">‚ú® Eclipse Attendance</div>
  <div class="navbar">
    <button class="tab-btn active-tab" onclick="switchTab('teacher')">Teacher Dashboard</button>
    <button class="tab-btn" onclick="switchTab('student')">Student Dashboard</button>
  </div>
  <div class="profile" onclick="toggleDropdown()">
    <img src="https://cdn-icons-png.flaticon.com/512/1077/1077114.png">
    <div class="dropdown" id="profile-dropdown">
      <a href="#" onclick="showProfile()">Profile</a>
      <a href="#" onclick="showSettings()">Settings</a>
    </div>
  </div>
</header>

<main>
  <!-- Teacher Dashboard -->
  <div id="teacher-dashboard">
    <div class="card">
      <h2>Create/Change Attendance Session</h2>
      <label>Session Name: </label>
      <input type="text" id="session-name" placeholder="Enter Session (e.g., DBMS Lab)">
      <label>Date: </label>
      <input type="date" id="session-date">
      <button onclick="startSession()">Start Session</button>
      <button onclick="downloadAttendance()">Download CSV</button>
      <p>Current Session: <span id="current-session">Not Started</span></p>
      <div id="teacher-qr" class="qr-container"></div>
    </div>
    <div class="card">
      <h2>Attendance Table</h2>
      <input type="text" id="search-name" placeholder="Search Name" oninput="filterAttendance()">
      <select id="filter-status" onchange="filterAttendance()">
        <option value="">All</option>
        <option value="present">Present</option>
        <option value="absent">Absent</option>
      </select>
      <table id="attendance-table">
        <thead><tr><th>Name</th><th>Status</th><th>Action</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <!-- Student Dashboard -->
  <div id="student-dashboard" style="display:none">
    <div class="card">
      <h2>Student QR Scan</h2>
      <div id="student-qr" class="qr-container"></div>
      <select id="student-name-select" onchange="renderAttendanceHistory()">
        <option value="">Select your name</option>
      </select>
      <p id="scan-status">Click "Scan QR" to mark attendance</p>
      <button onclick="scanQRCode()">Scan QR</button>
    </div>
    <div class="card">
      <h2>Your Attendance History</h2>
      <table id="attendance-history">
        <thead><tr><th>Session</th><th>Status</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <!-- Profile Page -->
  <div id="profile-page" style="display:none">
    <div class="card">
      <h2>üë§ Profile</h2>
      <p id="profile-info"></p>
    </div>
  </div>

  <!-- Settings Page -->
  <div id="settings-page" style="display:none">
    <div class="card">
      <h2>‚öôÔ∏è Settings</h2>
      <label><input type="checkbox" id="dark-toggle"> Dark Mode</label><br>
      <label><input type="checkbox" id="notify-toggle"> Enable Notifications</label>
    </div>
  </div>
</main>

<!-- QR Scan Modal -->
<div id="qr-modal">
  <div class="modal-content">
    <h3>Scan QR for Attendance</h3>
    <div id="modal-qr" style="margin:20px auto;"></div>
    <button onclick="confirmScan()">Scan Now ‚úÖ</button>
    <button style="position:absolute; top:10px; right:10px;" onclick="closeModal()">‚úñ</button>
  </div>
</div>

<script>
// ------------------ Data ------------------
const students = [
  "Arora","Harshith",
  "Steve","Billy","Akshath","Nancy","Dustin","Lucas","Max","Eleven","Mike","Will",
  "Jim","Joyce","Jonathan","Robin","Akshay","Divya Sri","Hopper",
  "Wednesday Addams","Enid Sinclair","Xavier","Dhanraj","Bianca",
  "Ajax","Tyler Galpin","Weems","Jon Snow","Peter Parker","Bruce",
  "Morticia","Shirisha","Millie","Dexter","Enola"
];
const attendance = {};
students.forEach(s=>attendance[s]={status:"absent",sessions:[]});
let currentSession = "Not Started";
let scanningStudent="";

// ------------------ Populate Student Select ------------------
const studentSelect=document.getElementById('student-name-select');
students.forEach(name=>{
  const opt=document.createElement('option'); opt.value=name; opt.textContent=name;
  studentSelect.appendChild(opt);
});

// ------------------ Tabs ------------------
function switchTab(tab){
  document.getElementById('teacher-dashboard').style.display=tab==='teacher'?'block':'none';
  document.getElementById('student-dashboard').style.display=tab==='student'?'block':'none';
  document.getElementById('profile-page').style.display='none';
  document.getElementById('settings-page').style.display='none';
  const buttons=document.querySelectorAll('.tab-btn'); buttons.forEach(b=>b.classList.remove('active-tab'));
  if(tab==='teacher') document.querySelector('.tab-btn[onclick="switchTab(\'teacher\')"]').classList.add('active-tab');
  else document.querySelector('.tab-btn[onclick="switchTab(\'student\')"]').classList.add('active-tab');
}

// ------------------ Dropdown ------------------
function toggleDropdown(){
  const d=document.getElementById("profile-dropdown");
  d.style.display=d.style.display==="block"?"none":"block";
}
function showProfile(){
  document.getElementById('teacher-dashboard').style.display='none';
  document.getElementById('student-dashboard').style.display='none';
  document.getElementById('settings-page').style.display='none';
  document.getElementById('profile-page').style.display='block';
  const role=(document.querySelector('.active-tab').textContent.includes("Teacher"))?"Teacher":"Student";
  const name=(role==="Teacher")?"Teacher Eclipse":(studentSelect.value||"Select your name");
  document.getElementById('profile-info').innerHTML=`<b>Name:</b> ${name}<br><b>Role:</b> ${role}<br><b>Email:</b> ${name.replace(/ /g,"").toLowerCase()}@eclipse.com`;
}
function showSettings(){
  document.getElementById('teacher-dashboard').style.display='none';
  document.getElementById('student-dashboard').style.display='none';
  document.getElementById('profile-page').style.display='none';
  document.getElementById('settings-page').style.display='block';
  document.getElementById("dark-toggle").checked=document.body.classList.contains("dark");
  document.getElementById("dark-toggle").onchange=()=>document.body.classList.toggle("dark");
  document.getElementById("notify-toggle").onchange=()=>alert("Notifications setting changed!");
}

// ------------------ Attendance ------------------
function startSession(){
  const name=document.getElementById("session-name").value.trim();
  const date=document.getElementById("session-date").value;
  if(!name||!date){alert("Enter both session name and date"); return;}
  currentSession=`${name} - ${date}`;
  document.getElementById("current-session").textContent=currentSession;
  generateQRCode('teacher'); renderAttendanceTable();
}
function generateQRCode(role){
  if(currentSession==="Not Started") return;
  const text=currentSession+"-ECLIPSE";
  const container=document.getElementById(role+'-qr');
  container.innerHTML='';
  new QRCode(container,{text,width:180,height:180});
}

// ------------------ Teacher Attendance Table ------------------
function renderAttendanceTable(){
  const tbody=document.querySelector('#attendance-table tbody'); tbody.innerHTML='';
  students.forEach(s=>{
    const tr=document.createElement('tr');
    const tdName=document.createElement('td'); tdName.textContent=s;
    const tdStatus=document.createElement('td'); tdStatus.innerHTML=`<span class="badge badge-${attendance[s].status}">${attendance[s].status.toUpperCase()}</span>`;
    const tdAction=document.createElement('td'); const btn=document.createElement('button'); btn.textContent="Mark Present"; btn.onclick=()=>markAttendance(s);
    tdAction.appendChild(btn); tr.appendChild(tdName); tr.appendChild(tdStatus); tr.appendChild(tdAction);
    tbody.appendChild(tr);
  });
}
function filterAttendance(){
  const nameFilter=document.getElementById('search-name').value.toLowerCase();
  const statusFilter=document.getElementById('filter-status').value;
  const tbody=document.querySelector('#attendance-table tbody'); tbody.innerHTML='';
  students.forEach(s=>{
    let match=true;
    if(nameFilter && !s.toLowerCase().includes(nameFilter)) match=false;
    if(statusFilter && attendance[s].status!==statusFilter) match=false;
    if(match){
      const tr=document.createElement('tr');
      const tdName=document.createElement('td'); tdName.textContent=s;
      const tdStatus=document.createElement('td'); tdStatus.innerHTML=`<span class="badge badge-${attendance[s].status}">${attendance[s].status.toUpperCase()}</span>`;
      const tdAction=document.createElement('td'); const btn=document.createElement('button'); btn.textContent="Mark Present"; btn.onclick=()=>markAttendance(s);
      tdAction.appendChild(btn); tr.appendChild(tdName); tr.appendChild(tdStatus); tr.appendChild(tdAction); tbody.appendChild(tr);
    }
  });
}
function markAttendance(s){
  attendance[s].status="present";
  attendance[s].sessions.push({session:currentSession,status:"Present"});
  renderAttendanceTable(); renderAttendanceHistory();
}

// ------------------ Student History ------------------
function renderAttendanceHistory(){
  const tbody=document.querySelector('#attendance-history tbody'); tbody.innerHTML='';
  const selected=studentSelect.value; if(!selected) return;
  attendance[selected].sessions.forEach(sess=>{
    const tr=document.createElement('tr');
    const tdSession=document.createElement('td'); tdSession.textContent=sess.session;
    const tdStatus=document.createElement('td'); tdStatus.innerHTML=`<span class="badge badge-present">${sess.status}</span>`;
    tr.appendChild(tdSession); tr.appendChild(tdStatus); tbody.appendChild(tr);
  });
}

// ------------------ QR Modal ------------------
function scanQRCode(){
  const selected=studentSelect.value;
  if(!selected){ alert("Please select your name!"); return; }
  if(currentSession==="Not Started"){ alert("No active session. Teacher must start a session."); return; }
  scanningStudent=selected;
  const modal=document.getElementById('qr-modal');
  modal.style.display='flex';
  document.getElementById('modal-qr').innerHTML='';
  new QRCode(document.getElementById('modal-qr'), {text: currentSession+"-ECLIPSE", width:180, height:180});
}
function confirmScan(){
  if(!scanningStudent) return;
  markAttendance(scanningStudent);
  document.getElementById('scan-status').textContent = `Attendance marked for ${scanningStudent} ‚úÖ`;
  scanningStudent="";
  closeModal();
}
function closeModal(){
  document.getElementById('qr-modal').style.display='none';
  document.getElementById('modal-qr').innerHTML='';
}

// ------------------ Download CSV ------------------
function downloadAttendance(){
  let csv="Name,Status,Sessions\n";
  students.forEach(s=>{
    const sessions = attendance[s].sessions.map(x=>x.session).join("|");
    csv+=`${s},${attendance[s].status},${sessions}\n`;
  });
  const blob=new Blob([csv], {type:"text/csv"});
  const link=document.createElement('a');
  link.href=URL.createObjectURL(blob);
  link.download="attendance.csv";
  link.click();
}

// ------------------ Init ------------------
generateQRCode('teacher'); renderAttendanceTable();
</script>

</body>
</html>
